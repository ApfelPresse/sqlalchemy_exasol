language: python
python:
  - '2.7'
  - '3.4'
env:
  global:
    - ODBCSYSINI=$TRAVIS_BUILD_DIR/odbcconfig
  matrix:
    - secure: "H/q3JA5v9HGZkvYfEXqLjEblLHncOui9Akh4qSMYi0oxPwPAbMb3bUjfEXq4nebW5oIIJncSJ+7Rigq9BCTqcNx/sLhIN5zhuV01pY0HjCqpGAVmqe5GVOsBE+j9EQ2zRSqXHc9ZFlD0sbnoc7Z28DcMlL4F9k6FjxZZkLW02lQ="
    - secure: "VM8Mc225TnKz6wiN0B497kAMTohU3g5PbOmRWme0QDl1R3DdfEw2jlBo6dYshYqlqX7TAAL6FJngrySMsYrSIGXP0XPSj96bEzH2Kb2oT98upH+xUR0rE3MSDwXovUFxUg/AplOWC1HWpRI3YcJyBsgH/srFM4vU3I7WQTyOTYY="
install:
  - sudo apt-get install unixODBC=2.2.14p2-5ubuntu3 unixODBC-dev=2.2.14p2-5ubuntu3
  - ./fix_unixodbc_so.sh
  - pip install -r requirements_test.txt
  - pip install python-coveralls
  - python setup.py -q install
before_script:
  # append db driver location to odbc config
  - echo DRIVER=$TRAVIS_BUILD_DIR/driver/libexaodbc-uo2214.so >> odbcconfig/odbcinst.ini
script: 
  - py.test --dropfirst --cov-config=.coveragerc --cov=sqlalchemy --dburi "${TESTDB#*=}"
after_success: 
  - coveralls
  # revert changes to odbc config to avoid dirty tag on deploy
  - git checkout odbcconfig/odbcinst.ini
deploy:
  provider: pypi
  user: BY-jk
  password:
    secure: SNyP2s6DV0Hm/gcFEk0iqllmeIvRU16YI/Gn7SF6+kT3EXyzE3gkPq0v/VRV4+n6wpNT2FELl69tZL87vXtYPxEiLXzSsWAuKmy9dapbf1bjzLjr3fVepEpesLPivYFFxToYa7osjunVVKxRNOzW5epCpRcWJP8bDiJKxH5BF38=
  on:
    all_branches: true
    tags: true
    repo: blue-yonder/sqlalchemy_exasol
